#!/usr/local/bin/system-python
import sys
import subprocess
import shlex


def main():
    result = subprocess.run(
        shlex.join(
            [
                "docker",
                "ps",
                "-a",
                "--format",
                "table {{.ID}}\t{{.Names}}\t{{.Image}}\t{{.Command}}\t{{.Status}}",
            ]
        )
        + " | peco",
        check=True,
        capture_output=True,
        shell=True,
        text=True,
    )
    if result.stdout.strip() == "":
        sys.exit(1)
        return
    selected_row = result.stdout.strip().split("\n")[-1]

    container_id = selected_row.strip().split(" ")[0]
    if container_id == "CONTAINER":
        sys.exit(1)
        return
    result = subprocess.run(
        shlex.join(
            [
                "docker",
                "inspect",
                container_id,
            ]
        )
        + " | less",
        shell=True,
    )


if __name__ == "__main__":
    main()
